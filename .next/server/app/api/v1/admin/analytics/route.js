(()=>{var e={};e.id=2496,e.ids=[2496],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},41098:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>p,BE:()=>u,Er:()=>i,HU:()=>c,aP:()=>l,nr:()=>d});var a=r(43205),s=r(85665),n=r.n(s);let o=process.env.JWT_SECRET||"your-secret-key";process.env.JWT_EXPIRES_IN;let i=async e=>n().hash(e,12),u=async(e,t)=>n().compare(e,t),c=e=>a.sign({id:e.id,email:e.email,username:e.username,role:e.role},o,{expiresIn:"7d"}),d=e=>{try{let t=a.verify(e,o);return{userId:t.id,email:t.email,username:t.username,role:t.role}}catch(e){return null}},l=e=>a.sign({email:e},o,{expiresIn:"1h"}),p=e=>{if(!e)return null;let t=e.split(" ");return 2!==t.length||"Bearer"!==t[0]?null:t[1]}},41506:(e,t,r)=>{"use strict";r.d(t,{E2:()=>o,ND:()=>n});var a=r(66437);let s="https://swhkbukgkafoqyvljmrd.supabase.co",n=(0,a.UU)(s,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3aGtidWtna2Fmb3F5dmxqbXJkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIyMDU1NzIsImV4cCI6MjA2Nzc4MTU3Mn0.kd0xWVLhcS0Ywog6-6CwmS4PRgz4hkyNibZGUSSRMRE"),o=(0,a.UU)(s,process.env.SUPABASE_SERVICE_ROLE_KEY)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},91767:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d});var s=r(96559),n=r(48088),o=r(37719),i=r(32190),u=r(41098),c=r(41506);async function d(e){try{let t=e.headers.get("authorization")?.replace("Bearer ","");if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=(0,u.nr)(t);if(!r)return i.NextResponse.json({error:"Invalid token"},{status:401});let{data:a,error:s}=await c.E2.from("users").select("role").eq("id",r.userId).single();if(s||"admin"!==a.role)return i.NextResponse.json({error:"Forbidden"},{status:403});let{searchParams:n}=new URL(e.url),o=n.get("period")||"30",d=new Date;d.setDate(d.getDate()-parseInt(o));let{count:l}=await c.E2.from("users").select("*",{count:"exact",head:!0}),{count:p}=await c.E2.from("users").select("*",{count:"exact",head:!0}).gte("created_at",d.toISOString()),{count:m}=await c.E2.from("users").select("*",{count:"exact",head:!0}).eq("role","creator"),{data:g}=await c.E2.from("donations").select("creator_id").eq("status","completed").gte("created_at",d.toISOString()),x=new Set(g?.map(e=>e.creator_id)).size,{data:f}=await c.E2.from("donations").select("amount").eq("status","completed"),_=f?.reduce((e,t)=>e+t.amount,0)||0,v=f?.length||0,{data:w}=await c.E2.from("donations").select("amount").eq("status","completed").gte("created_at",d.toISOString()),y=w?.reduce((e,t)=>e+t.amount,0)||0,I=w?.length||0,{data:h}=await c.E2.from("users").select(`
        id,
        username,
        full_name,
        avatar,
        total_donations,
        total_earnings
      `).eq("role","user").order("total_donations",{ascending:!1}).limit(10),{data:q}=await c.E2.from("donations").select(`
        id,
        amount,
        message,
        donor_id,
        recipient_id,
        is_anonymous,
        created_at
      `).order("created_at",{ascending:!1}).limit(20),S=[];for(let e=parseInt(o)-1;e>=0;e--){let t=new Date;t.setDate(t.getDate()-e);let r=new Date(t.setHours(0,0,0,0)),a=new Date(t.setHours(23,59,59,999)),{count:s}=await c.E2.from("users").select("*",{count:"exact",head:!0}).gte("created_at",r.toISOString()).lt("created_at",a.toISOString()),{data:n}=await c.E2.from("donations").select("amount").eq("status","completed").gte("created_at",r.toISOString()).lt("created_at",a.toISOString()),o=n?.reduce((e,t)=>e+t.amount,0)||0;S.push({date:r.toISOString().split("T")[0],users:s||0,donations:n?.length||0,revenue:o})}let E={overview:{totalUsers:l||0,newUsers:p||0,totalCreators:m||0,activeCreators:x,totalDonations:_,totalDonationCount:v,periodDonations:y,periodDonationCount:I,averageDonation:v>0?_/v:0},topCreators:await Promise.all(h?.map(async e=>{let{count:t}=await c.E2.from("donations").select("donor_id",{count:"exact",head:!0}).eq("recipient_id",e.id);return{id:e.id,username:e.username,displayName:e.full_name||e.username,avatar:e.avatar||"/default-avatar.png",totalDonations:e.total_donations||0,totalSupporters:t||0}})||[]),recentDonations:await Promise.all(q?.map(async e=>{let{data:t}=await c.E2.from("users").select("username, full_name").eq("id",e.donor_id).single(),{data:r}=await c.E2.from("users").select("username, full_name, avatar").eq("id",e.recipient_id).single();return{id:e.id,amount:e.amount,message:e.message,supporterName:e.is_anonymous?"Anonymous":t?.full_name||t?.username||"Unknown",isAnonymous:e.is_anonymous,createdAt:e.created_at,creator:{username:r?.username||"unknown",displayName:r?.full_name||r?.username||"Unknown",avatar:r?.avatar||"/default-avatar.png"}}})||[]),dailyAnalytics:S};return i.NextResponse.json({success:!0,data:E})}catch(e){return i.NextResponse.json({error:"Failed to fetch analytics"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v1/admin/analytics/route",pathname:"/api/v1/admin/analytics",filename:"route",bundlePath:"app/api/v1/admin/analytics/route"},resolvedPagePath:"/Users/erico/socialbuzz/my-socialbuzz-clone/app/api/v1/admin/analytics/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:p,workUnitAsyncStorage:m,serverHooks:g}=l;function x(){return(0,o.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:m})}},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,6437,5701],()=>r(91767));module.exports=a})();